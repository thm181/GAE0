---
title: "GAE0 -- Introduction to using GitHub Classroom"
author: "TH Martin"
date: "Spring 2021"
output:
  bookdown::html_document2:
    toc: true
    number_sections: false
bibliography: 
- GAE0.bib
- R-GAE0.bib
csl: ecology.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)

library(latex2exp)
library(papaja)
library(gtsummary)
library(tidyverse)


# Use the papaja package to create a bibliography of package citations:
papaja::r_refs(file = "R-GAE0.bib")

```

# Scenario 1

Relatively early in your textbook [@QK], you'll be introduced to an example data set that was generated by @lovettetal2000. They studied the chemistry of forested watersheds in the Catskill Mountains in New York State. We'll use this data file, ***lovett.csv*** as an introduction to using LaTeX to write symbols and equations and to become more familiar with R, RStudio, and github.

@lovettetal2000 chose 39 sites (observations) on first and second order streams and measured the concentrations of ten chemical variables averaged over three years, and four watershed variables (maximum elevation (m), sample elevation (m), length of stream (m), watershed area (ha)).:

1.  $NO_3^-$ (`NO3`),
2.  Total Organic $N$ (`TON`),
3.  Total $N$ (`TN`),
4.  $NH_4^2$ (`NH4`),
5.  Dissolved Organic $C$ (`DOC`),
6.  $SO_4$ (`SO4`),
7.  $Cl^-$ (`CL`),
8.  $Ca^{2+}$ (`CA`),
9.  $Mg^{2+}$ (`MG`),
10. $H^+$ (`H`).

## Statistical Methods:

Use the tbl_summary() function from the gtsummary package [@R-gtsummary] in R [@R-base] to produce a formatted table that reports the mean and standard deviation, median and interquartile range (IQR), and sample size for each of the variables that were measured. Use ggplot() provided by the ggplot2 package ([@R-ggplot2]) included in the tidyverse package [@R-tidyverse] to produce a scatter plots of $H^+$ versus $Ca^{2+}$.

```{r dataImport}
df1 <- read_csv("lovett.csv")

df2 <- df1 %>%
  mutate(E_class = ifelse(between(SAMPELEV, 0, 443), "low",
                          ifelse(between(SAMPELEV, 444, 615), "mid", "high")
                          )
  ) %>%
  group_by(E_class)

df2$E_class <- factor(df2$E_class, 
                      levels = c("low", "mid", "high"),
                      labels = c("< 444 m", "444 to 615 m", "> 615 m"))
```

## Results

Lower elevation streams drained larger catchments (Table \@ref(tab:Tab1)). ***<Now you say something about CL, DOC, and MG and cite the table>***

```{r Tab1, results='asis'}
Tab1 <- tbl_summary(df2,
                    include = -STREAM,
                    by = E_class,
                    statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%
  modify_caption("Mean and (standard deviation) for all measured variables.") %>%
  modify_header(label = "**Variable**") %>%
  modify_header(stat_by =  "**{level}**<br>n = {n}")

as_kable(Tab1)
```
***<And here would be a good place to say something about the graph and site it.>***


```{r fig1, fig.cap="$H^+$ plotted against $Ca^{2+}$ for all sites overlain with a spline curve to help emphasize the pattern."}
Ylabel <- TeX("$H^+")
Xlabel <- TeX("$Ca^{2+}$")

ggplot(df2) +
  geom_point(aes(x = CA, y = H), 
             color = "darkorchid4",
             fill = "darkorchid1",
             size = 4, 
             shape = 21,
             alpha = 0.6) +
  geom_smooth(aes(x = CA, y = H), se = FALSE) +
  scale_y_continuous(Ylabel, limits = c(0,1.5), breaks = c(0, 0.5, 1.0, 1.5)) +
  scale_x_continuous(Xlabel, limits = c(25,125), breaks = seq(25,125,25)) +
  theme_classic(base_size = 20)
```



# References:
